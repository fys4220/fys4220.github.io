

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2.11. Metastability and synchronization &#8212; Real-time and embedded data systems</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'part-vhdl/vhdl_metastability';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.12. Generic map" href="vhdl_generics.html" />
    <link rel="prev" title="2.10. VHDL Process" href="vhdl_process.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/fys4220_logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/fys4220_logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-information/information_agenda.html">Weekly agenda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-information/information_content_overview.html">Content and learning objectives</a></li>

<li class="toctree-l1"><a class="reference internal" href="../part-information/information_tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-information/information_download_tools.html">Quartus and ModelSim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-information/information_prepare_git.html">Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Other resources</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.uio.no/FYS4220-2023">Github organization page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.uio.no/orgs/FYS4220-2023/discussions">Discussion forum</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Main content</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-fpga/fpga.html">1. FPGA technology</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-fpga/pld_introduction.html">1.1. Programmable logic devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-fpga/fpga_introduction.html">1.2. Field Programmable Gate Arrays</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="vhdl.html">2. VHDL</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="vhdl_history.html">2.2. History</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_design_units.html">2.3. Design units and structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_design_flow.html">2.4. Design flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_objects_data_types.html">2.5. Objects and data types</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_operators.html">2.6. Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_concurrent_statements.html">2.7. Concurrent statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_description_models.html">2.8. Description styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_testbenches.html">2.9. Testbenches</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_process.html">2.10. VHDL Process</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">2.11. Metastability and synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_generics.html">2.12. Generic map</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_state_machines.html">2.13. State machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="vhdl_packages_subprograms.html">2.14. Packages and subprograms</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-embedded/embedded_intro.html">3. Embedded systems</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_nios2.html">3.1. Nios II CPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_softcore.html">3.2. Soft core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_memory_mapped.html">3.3. Memory mapped interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_hal.html">3.4. Hardware Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_nios2_system_development.html">3.5. Nios II system development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-embedded/embedded_interrupt.html">3.6. Interrupt handling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-rtos/rtos_intro.html">4. RTOS</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-rtos/rtos_ucosii.html">4.1. uC/OS-II</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-rtos/rtos_tasks.html">4.2. Scheduling and task management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-rtos/rtos_latency_jitter.html">4.3. Latency &amp; jitter</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../part-rtos/rtos_intertask_communication.html">4.4. Intertask communication</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../part-rtos/rtos_semaphores.html">4.4.1. Semaphores</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part-rtos/rtos_priority_inversion.html">4.4.2. Priority inversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../part-rtos/rtos_messages.html">4.4.3. Messages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-exercises/exercises_intro.html">Overview</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-exercises/exercises_vhdl.html">VHDL</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_your_first_fpga_project.html">EX1: Your first FPGA project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_adder.html">EX2: Adder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_counter.html">EX3: 4-bit up-counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_state_machine.html">EX4: State machine</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-exercises/exercises_embedded.html">Embedded systems</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_nios2_example.html">EX5: A basic Nios II system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_memory_mapped_sw.html">EX6: Accessing Nios II memory mapped modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_nios2_interrupt.html">EX7: Nios II interrupt handling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../part-exercises/exercises_rtos.html">RTOS</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_rtos_basic_example.html">EX8: A basic RTOS application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../part-exercises/exercises_rtos_semaphores_example.html">EX9: Semaphore example</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../part-project/project_intro.html">Project overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-project/project_uart.html">P1: UART controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-project/project_nios2.html">P2: Microcontroller system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../part-project/data_rate.html">P3: RTOS</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/part-vhdl/vhdl_metastability.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Metastability and synchronization</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-hold-times">2.11.1. Setup and hold times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelining">2.11.2. Pipelining</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronization">2.11.3. Synchronization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection">2.11.4. Edge detection</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="metastability-and-synchronization">
<span id="vhdl-metastability"></span><h1><span class="section-number">2.11. </span>Metastability and synchronization<a class="headerlink" href="#metastability-and-synchronization" title="Permalink to this heading">#</a></h1>
<p>Metastability is a phenomenon that can lead to system failure in digital devices such as FPGAs. It can occur when signals are transferred between registers of unrelated or asynchronous clock domains, as shown in <a class="reference internal" href="#fig-vhdl-metastability-clock-domain-crossing"><span class="std std-numref">Fig. 2.34</span></a>. Or when the combinational path between to registers is too long for the signal to become stable at the input of the next register in time for the next transition on the clock, see <a class="reference internal" href="#fig-vhdl-metastability-register-to-register-path"><span class="std std-numref">Fig. 2.35</span></a>.</p>
<figure class="align-center" id="fig-vhdl-metastability-clock-domain-crossing">
<a class="reference internal image-reference" href="../_images/vhdl_metastability_clock_domain_crossing.png"><img alt="../_images/vhdl_metastability_clock_domain_crossing.png" src="../_images/vhdl_metastability_clock_domain_crossing.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.34 </span><span class="caption-text">If clk1 and clk2 are skewed/sliding with respect to each other (or of different frequency or unrelated), the data received in clock domain B may violate the setup and hold time of the input register in this domain. The same is the case for an external and asynchronous signal arriving into clock domain A.</span><a class="headerlink" href="#fig-vhdl-metastability-clock-domain-crossing" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="fig-vhdl-metastability-register-to-register-path">
<a class="reference internal image-reference" href="../_images/vhdl_metastability_register_to_register_path.png"><img alt="../_images/vhdl_metastability_register_to_register_path.png" src="../_images/vhdl_metastability_register_to_register_path.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.35 </span><span class="caption-text">If the combinational path is to long for the signal to arrive at the input of the second register in due time of the next active edge of the clock, this violates the timing requirements of the design, and timing closure can not be met.</span><a class="headerlink" href="#fig-vhdl-metastability-register-to-register-path" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<section id="setup-and-hold-times">
<h2><span class="section-number">2.11.1. </span>Setup and hold times<a class="headerlink" href="#setup-and-hold-times" title="Permalink to this heading">#</a></h2>
<p>A flip-flop has a requirement to when new data may change with respect to the active edge of the clock. That is, the input of the flip flop must have changed and be stable at a given time before the clock edge, and remain stable for a given time after the clock has changes. This is referred to as <em>setup-time (<span class="math notranslate nohighlight">\(t_s\)</span>)</em> and <em>hold-time (<span class="math notranslate nohighlight">\(t_h\)</span>)</em> respectively. If this requirement is not met it is referred to as a “timing violation”. It may lead to a metastable state of the flip-flop where its output is unstable and unpredictable for a short amount of time, before it eventually and randomly settles to either its previous value or to its new value.</p>
<p><strong>setup-time (<span class="math notranslate nohighlight">\(t_s\)</span>)</strong>: is the minimum amount of time before the clock’s active edge that the data must be stable for it to be latched correctly.</p>
<p><strong>hold-time (<span class="math notranslate nohighlight">\(t_h\)</span>)</strong>: is the minimum amount of time after a clock’s active edge during which the data must be stable.</p>
<figure class="align-center" id="fig-vhdl-wave-metastability-ts-th">
<a class="reference internal image-reference" href="../_images/wave_metastability_ts_th.png"><img alt="../_images/wave_metastability_ts_th.png" src="../_images/wave_metastability_ts_th.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.36 </span><span class="caption-text">Wave diagram illustrating setup time and hold time with respect to the data and clock signals.</span><a class="headerlink" href="#fig-vhdl-wave-metastability-ts-th" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>When a signal is transferred between registers, the input of the receiving register must be stable at least <span class="math notranslate nohighlight">\(t_s\)</span> before the capturing edge of the clock. This is demonstrated in the wave diagram in <a class="reference internal" href="#fig-vhdl-metastability-combinational-delay"><span class="std std-numref">Fig. 2.37</span></a>.</p>
<figure class="align-center" id="fig-vhdl-metastability-combinational-delay">
<a class="reference internal image-reference" href="../_images/wave_metastability_combinational_delay.png"><img alt="../_images/wave_metastability_combinational_delay.png" src="../_images/wave_metastability_combinational_delay.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.37 </span><span class="caption-text">Data from FF1 much reach the input of FF2 well before the setup requirement. The labels correspond to the labels used in <a class="reference internal" href="#fig-vhdl-metastability-register-to-register-path"><span class="std std-numref">Fig. 2.35</span></a></span><a class="headerlink" href="#fig-vhdl-metastability-combinational-delay" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The value at the input of the first register (FF1.D) is captured at the launching edge of the clock. This value then starts the race of reaching the input of the next register in time to be captured at the next active clock edge. The clk-to-Q delay corresponds to the time it takes for the input value to propagate through the register from D to Q. The signal then has to propagate through the combinational path between the two registers before it arrives at the input FF2.D. If the arrival time is before the required setup time <span class="math notranslate nohighlight">\(t_s\)</span>, the signal value is correctly captured by the second register. We say that the timing requirement for that path is met with a corresponding positive slack. If the arrival time is after the required time, the timing requirement is not met, and we have a negative slack. In this case, a redesign of the path may be necessary.</p>
</section>
<section id="pipelining">
<h2><span class="section-number">2.11.2. </span>Pipelining<a class="headerlink" href="#pipelining" title="Permalink to this heading">#</a></h2>
<p>For example, the timing can be improved by splitting the combinational path in two shorter paths separated by an additional register. This will delay the signal by one clock cycle, but with the two shorter combinational paths, the signal is now correctly propagated through the logic without risking a metastable state. This solution is also known as a pipelining and is conceptually illustrated in <a class="reference internal" href="#fig-vhdl-metastability-pipelining"><span class="std std-numref">Fig. 2.38</span></a>.</p>
<figure class="align-center" id="fig-vhdl-metastability-pipelining">
<a class="reference internal image-reference" href="../_images/vhdl_metastability_pipelining.png"><img alt="../_images/vhdl_metastability_pipelining.png" src="../_images/vhdl_metastability_pipelining.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.38 </span><span class="caption-text">Assume that combinational logic neede to compute A + B + C is too long for the signal to reach the input of the second register in time for the next clock edge. The computation can then be split into to paths separated by a register. Individually, each computation now creates a shorter combinational path capable of meeting the timing requirements.</span><a class="headerlink" href="#fig-vhdl-metastability-pipelining" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="synchronization">
<h2><span class="section-number">2.11.3. </span>Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this heading">#</a></h2>
<p>The probability of metastability can be reduced by first aligning the incoming signal to the clock of the local clock domain. By bringing the incoming signal through two registers, as illustrated in <a class="reference internal" href="#fig-vhdl-metastability-synchronization-registers"><span class="std std-numref">Fig. 2.39</span></a>, the signal is effectively synchronized to the clock of the receiving clock domain.</p>
<figure class="align-center" id="fig-vhdl-metastability-synchronization-registers">
<a class="reference internal image-reference" href="../_images/vhdl_metastability_synchronization_registers.png"><img alt="../_images/vhdl_metastability_synchronization_registers.png" src="../_images/vhdl_metastability_synchronization_registers.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.39 </span><span class="caption-text">An accepted rule of thumb to reduced the probability of metastability is to use to synchronization registers to align the incoming signal with the local clock.</span><a class="headerlink" href="#fig-vhdl-metastability-synchronization-registers" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The wave diagram in <a class="reference internal" href="#fig-vhdl-metastability-synchronization-registers-new-value"><span class="std std-numref">Fig. 2.40</span></a> shows how the synchronization registers work.</p>
<figure class="align-center" id="fig-vhdl-metastability-synchronization-registers-new-value">
<a class="reference internal image-reference" href="../_images/wave_metastability_synchronization_registers_new_value.png"><img alt="../_images/wave_metastability_synchronization_registers_new_value.png" src="../_images/wave_metastability_synchronization_registers_new_value.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.40 </span><span class="caption-text">Wave diagram showing the propagation of an incoming signal through the two synchronization registers. In this example the metastable output of the first synchronization register settles at the new value. <a class="reference internal" href="#fig-vhdl-metastability-synchronization-registers-old-value"><span class="std std-numref">Fig. 2.41</span></a> shows the case when it settles at the old value.</span><a class="headerlink" href="#fig-vhdl-metastability-synchronization-registers-new-value" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Here the incoming signal changes too close to the clock edge and therefore violates the setup time of the first register R1.  This brings the output of R1 into a metastable state, from which it is impossible to predict the resulting value. In this example the output eventually settles at the new value. A short propagation delay later, this new value then arrives at the input of R2. As long as the metastable state and propagation delay is shorter than the clock cycle and meets the setup time of the second register, R2 can correctly clock through the new value. The solution allows the first of the two registers to become metastable while the second register shields that metastable state from the internal logic. No logic must be introduced in the path between the two synchronization registers.</p>
<p>The example above shows what happens if the metastable state returns to the new value. However, what if the metastable state returns to the old value. This is illustrated in the wave diagram in <a class="reference internal" href="#fig-vhdl-metastability-synchronization-registers-old-value"><span class="std std-numref">Fig. 2.41</span></a>.</p>
<figure class="align-center" id="fig-vhdl-metastability-synchronization-registers-old-value">
<a class="reference internal image-reference" href="../_images/wave_metastability_synchronization_registers_old_value.png"><img alt="../_images/wave_metastability_synchronization_registers_old_value.png" src="../_images/wave_metastability_synchronization_registers_old_value.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.41 </span><span class="caption-text">Wave diagram showing the propagation of an incoming signal through the two synchronization registers. In this example the metastable output of the first synchronization register settles at the old value. <a class="reference internal" href="#fig-vhdl-metastability-synchronization-registers-new-value"><span class="std std-numref">Fig. 2.40</span></a> shows the case when it settles at the new value.</span><a class="headerlink" href="#fig-vhdl-metastability-synchronization-registers-old-value" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Using synchronization registers to align the incoming signal with the local clock only works if the clock frequency of the local clock domain is higher than clock domain driving the incoming signal. If the driving clock domain runs at a higher frequency, the receiving clock domain will not be able to capture the incoming value before it changes to a new value. In this case a different synchronization mechanism is required, such as adding handshake signals. This is however, outside the scope of this course.</p>
</section>
<section id="edge-detection">
<span id="vhdl-metastability-edge-detection"></span><h2><span class="section-number">2.11.4. </span>Edge detection<a class="headerlink" href="#edge-detection" title="Permalink to this heading">#</a></h2>
<p>Sometimes an external signal like for instance a key press is used to trigger an event in the FPGA design. A key press is an asynchronous signal with a duration much longer than the clock frequency of the FPGA design. In this course we are using a 50 MHz clock, which corresponds to clock period of 20 ns. If you are reactive, you may be able to reduce the duration of a key press to a few hundreds of milliseconds. It is clear that if you press the key and simply trigger on the level of that signal, the internal event will be much longer than a single clock period. If this signal is used to trigger a single increment of a counter, the counter will increment by a lot more than one.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">architecture</span><span class="w"> </span><span class="nc">rtl</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">edge_detection</span><span class="w"> </span><span class="k">is</span>
<span class="k">begin</span>
<span class="w">  </span>
<span class="w">  </span><span class="nc">p_reg</span><span class="o">:</span><span class="w"> </span><span class="k">process</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span>
<span class="w">    </span><span class="k">begin</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1">-- trigger on the external active low signal signal</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="w"> </span><span class="k">then</span><span class="w">  </span>
<span class="w">          </span><span class="n">counter</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">process</span><span class="p">;</span>

<span class="k">end</span><span class="w"> </span><span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>The VHDL description above will result in the behaviour shown in <a class="reference internal" href="#fig-vhdl-enable-counter"><span class="std std-numref">Fig. 2.42</span></a></p>
<figure class="align-center" id="fig-vhdl-enable-counter">
<a class="reference internal image-reference" href="../_images/wave_enable_counter.png"><img alt="../_images/wave_enable_counter.png" src="../_images/wave_enable_counter.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.42 </span><span class="caption-text">If the enable signal has a longer duration than the counter, the counter will increment by more than one.</span><a class="headerlink" href="#fig-vhdl-enable-counter" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To avoid this we need to trigger the counter on one of the edges of the enable signal. A first natural idea would be to use one of the functions <code class="docutils literal notranslate"><span class="pre">rising_edge()</span></code> and <code class="docutils literal notranslate"><span class="pre">falling_edge()</span></code>. However, these functions are only allowed to be used on clock signals. The synthesis tools interpret the argument to these functions as a dedicated clock signal. They can therefore not be used on regular logic signals in the design. Instead, we will have to design custom edge detection logic. By bringing the incoming enable signal through a register it is possible to detect the transition on the signal by monitoring each side of the register. If we want to detect the falling edge of the signal, the required condition is that the incoming signal changes to ‘0’ while the output of the register not yet has been updated with this new value. By inverting the incoming signal and comparing it to the output of the register through an <em>AND</em>-gate, a one clock cycle long pulse is generated. The corresponding circuit and resulting wave diagram is shown in <a class="reference internal" href="#fig-vhdl-pulse-generator"><span class="std std-numref">Fig. 2.43</span></a> and <a class="reference internal" href="#fig-vhdl-wave-pulse-generator"><span class="std std-numref">Fig. 2.44</span></a> respectively.</p>
<figure class="align-center" id="fig-vhdl-pulse-generator">
<a class="reference internal image-reference" href="../_images/vhdl_pulse_generator.png"><img alt="../_images/vhdl_pulse_generator.png" src="../_images/vhdl_pulse_generator.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.43 </span><span class="caption-text">Single shot pulse generator.</span><a class="headerlink" href="#fig-vhdl-pulse-generator" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center" id="fig-vhdl-wave-pulse-generator">
<a class="reference internal image-reference" href="../_images/wave_pulse_generator.png"><img alt="../_images/wave_pulse_generator.png" src="../_images/wave_pulse_generator.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.44 </span><span class="caption-text">Wave diagram for the single shot pulse generator.</span><a class="headerlink" href="#fig-vhdl-wave-pulse-generator" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The corresponding VHDL description is shown below.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">architecture</span><span class="w"> </span><span class="nc">rtl</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">edge_detection</span><span class="w"> </span><span class="k">is</span>
<span class="w">  </span><span class="k">signal</span><span class="w"> </span><span class="n">enable_i_n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
<span class="w">  </span>
<span class="w">  </span><span class="nc">p_reg</span><span class="o">:</span><span class="w"> </span><span class="k">process</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span>
<span class="w">    </span><span class="k">begin</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="n">enable_i_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_n</span><span class="p">;</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">process</span><span class="p">;</span>

<span class="w">  </span><span class="c1">-- Create the falling edge detection and thus</span>
<span class="w">  </span><span class="c1">-- a pulse with a duration of one single clock</span>
<span class="w">  </span><span class="c1">-- cycle</span>
<span class="w">  </span><span class="n">pulse</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">enable_n</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">enable_i_n</span><span class="p">;</span>

<span class="w">  </span><span class="c1">-- If you want to create a pulse on the rising edge</span>
<span class="w">  </span><span class="c1">-- of the input enable signal, place instead the inverter</span>
<span class="w">  </span><span class="c1">-- at the output of the register, effectively inverting</span>
<span class="w">  </span><span class="c1">-- the enable_i_n signal as shown in the commented line</span>
<span class="w">  </span><span class="c1">-- below.</span>
<span class="w">  </span><span class="c1">-- pulse &lt;= enable_n and not enable_i_n;</span>

<span class="k">end</span><span class="w"> </span><span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<!--
The circuit above detects the falling edge. By moving the *not* gate to the output of the register, it will detect the rising edge:

```{code-block} vhdl
  pulse <= enable_n and not enable_i_n;
```
-->
<p>This circuit assumes that the incoming enable signal already is synchronized to the same clock that is used to drive the register. However, since this signal is an external key press, it must also first be synchronized into the local clock domain, using synchronization registers as shown earlier. The resulting logic can be seen in <a class="reference internal" href="#fig-vhdl-synchronization-registers"><span class="std std-numref">Fig. 2.45</span></a>.</p>
<p>This results in pulse on the output with a duration of a single clock cycle, which in turn can be used as an enable signal for a counter or any other logic requiring a single pulse. You will use approach to create an enable signal for the counter design in <a class="reference internal" href="../part-exercises/exercises_counter.html#exercises-counter"><span class="std std-ref">EX3: 4-bit up-counter</span></a>.</p>
<figure class="align-center" id="fig-vhdl-synchronization-registers">
<a class="reference internal image-reference" href="../_images/vhdl_synchronization_registers_v2.png"><img alt="../_images/vhdl_synchronization_registers_v2.png" src="../_images/vhdl_synchronization_registers_v2.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.45 </span><span class="caption-text">The two input registers synchronizes the incoming signal to the local clock domain.</span><a class="headerlink" href="#fig-vhdl-synchronization-registers" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The VHDL implementation of the diagram above is shown below:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">library</span><span class="w"> </span><span class="nn">ieee</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nn">ieee.std_logic_1164.</span><span class="k">all</span><span class="p">;</span>

<span class="c1">-- This module detects the falling edge of the asynchronous</span>
<span class="c1">-- active low incoming enable_n signal and generates a single</span>
<span class="c1">-- active high output pulse with a duration equal to the length of</span>
<span class="c1">-- one clock cycle of the incoming clock clk.</span>
<span class="k">entity</span><span class="w"> </span><span class="nc">edge_detection</span><span class="w"> </span><span class="k">is</span>
<span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="n">enable_n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="n">pulse</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span>
<span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">edge_detection</span><span class="p">;</span>


<span class="k">architecture</span><span class="w"> </span><span class="nc">rtl</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nc">edge_detection</span><span class="w"> </span><span class="k">is</span>

<span class="w">  </span><span class="c1">-- Signal for the two synchronization registers</span>
<span class="w">  </span><span class="k">signal</span><span class="w"> </span><span class="n">enable_r1_n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">  </span><span class="k">signal</span><span class="w"> </span><span class="n">enable_r2_n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">  </span><span class="c1">-- Signal for the edge detection register</span>
<span class="w">  </span><span class="k">signal</span><span class="w"> </span><span class="n">enable_i_n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="k">begin</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">-- This process the 3 registeres through</span>
<span class="w">  </span><span class="c1">-- which the input enable signal is clocked to</span>
<span class="w">  </span><span class="c1">-- to first synchronize the signal and then to add</span>
<span class="w">  </span><span class="c1">-- a register used for the combinational edge detection logic</span>
<span class="w">  </span><span class="c1">-- described in the separate statement below. </span>
<span class="w">  </span><span class="nc">p_synchronization</span><span class="o">:</span><span class="w"> </span><span class="k">process</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span>
<span class="w">    </span><span class="k">begin</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="c1">-- First bring the input signal through the </span>
<span class="w">        </span><span class="c1">-- two synchronization registers</span>
<span class="w">        </span><span class="n">enable_r1_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_n</span><span class="p">;</span>
<span class="w">        </span><span class="n">enable_r2_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_r1_n</span><span class="p">;</span>
<span class="w">        </span><span class="c1">-- Additional register for edge detection functionality</span>
<span class="w">        </span><span class="n">enable_i_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_r2_n</span><span class="p">;</span>
<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">process</span><span class="p">;</span>

<span class="w">  </span><span class="c1">-- Create the falling edge detection and thus</span>
<span class="w">  </span><span class="c1">-- a pulse with a duration of one single clock</span>
<span class="w">  </span><span class="c1">-- cycle</span>
<span class="w">  </span><span class="n">pulse</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">enable_r2_n</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">enable_i_n</span><span class="p">;</span>

<span class="k">end</span><span class="w"> </span><span class="k">architecture</span><span class="p">;</span>
</pre></div>
</div>
<p>The figure below shows the corresponding wave diagram. The signal <em>enable_n</em> is shown as an asynchronous signal, changing indpendently of the clock.</p>
<figure class="align-center" id="fig-vhdl-wave-pulse-generator-with-synchronization">
<a class="reference internal image-reference" href="../_images/wave_pulse_generator_with_synchronization.png"><img alt="../_images/wave_pulse_generator_with_synchronization.png" src="../_images/wave_pulse_generator_with_synchronization.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.46 </span><span class="caption-text">Wave diagram for the single shot pulse generator.</span><a class="headerlink" href="#fig-vhdl-wave-pulse-generator-with-synchronization" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="dropdown admonition">
<p class="admonition-title">What would happen if you wrote the statement for generating the pulse signal inside the process?</p>
<p>Adding the statement to the synchronous process will result in an additional register at the end of the signal path.  This will delay the pulse signal by one clock cycle. This may or may not be important, depending on the application. In our case this is not needed. The corresponding code and schematic is shown below.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="nc">p_synchronization</span><span class="o">:</span><span class="w"> </span><span class="k">process</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span>
<span class="w">    </span><span class="k">begin</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">rising_edge</span><span class="p">(</span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">        </span><span class="n">enable_r1_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_n</span><span class="p">;</span>
<span class="w">        </span><span class="n">enable_r2_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_r1_n</span><span class="p">;</span>
<span class="w">        </span><span class="n">enable_i_n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">enable_r2_n</span><span class="p">;</span>

<span class="w">        </span><span class="c1">-- Each statement within a synchronous process will create a register</span>
<span class="w">        </span><span class="n">pulse</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">enable_r2_n</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">enable_i_n</span><span class="p">;</span>

<span class="w">      </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="p">;</span>
<span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="k">process</span><span class="p">;</span>
</pre></div>
</div>
<figure class="align-center" id="fig-vhdl-synchronization-registers-v3">
<a class="reference internal image-reference" href="../_images/vhdl_synchronization_registers_v3.png"><img alt="../_images/vhdl_synchronization_registers_v3.png" src="../_images/vhdl_synchronization_registers_v3.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2.47 </span><span class="caption-text">Four registers will be created by the code above, one for each statement.</span><a class="headerlink" href="#fig-vhdl-synchronization-registers-v3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
<div class="admonition-supplementary-suggested-reading admonition">
<p class="admonition-title">Supplementary suggested reading:</p>
<p>The Altera white paper on <a class="reference download internal" download="" href="../_downloads/df2e54885775d45c8304d0481fa8f12f/wp-01082-quartus-ii-metastability.pdf"><code class="xref download docutils literal notranslate"><span class="pre">understanding</span> <span class="pre">metastability</span> <span class="pre">in</span> <span class="pre">FPGAs</span></code></a>.</p>
<p>Chapter 7, section 7.1.1 and 7.1.2 in LaMeres <span id="id1">[<a class="reference internal" href="../references.html#id10" title="Brock K. LaMeres. Introduction to Logic Circuits &amp; Logic Design with VHDL. Springer Cham, 2019.">LaM19</a>]</span>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link-springer-com.ezproxy.uio.no/chapter/10.1007/978-3-030-12489-2_7">Direct link html-version</a></p></li>
<li><p><a class="reference external" href="https://link.springer.com/content/pdf/10.1007%2F978-3-030-12489-2_7">Direct link pdf-version</a></p></li>
</ul>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./part-vhdl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="vhdl_process.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2.10. </span>VHDL Process</p>
      </div>
    </a>
    <a class="right-next"
       href="vhdl_generics.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2.12. </span>Generic map</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-hold-times">2.11.1. Setup and hold times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipelining">2.11.2. Pipelining</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronization">2.11.3. Synchronization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-detection">2.11.4. Edge detection</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ketil Røed
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>